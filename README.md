# Video Recommendation Engine

This project implements a sophisticated, hybrid video recommendation engine using a Graph Neural Network (GNN) for personalized recommendations and a content-based model for handling the cold-start problem. The entire system is served via a robust FastAPI application.

## 1. System Architecture

The recommendation engine is built on a three-tiered hybrid architecture that intelligently serves the most appropriate recommendations based on a user's interaction history. This design ensures both deep personalization for established users and relevant content for new users.

For a detailed technical breakdown, please refer to `docs/recommendation_system.md`.

-   **Tier 1: The Cold-Start Engine (Mood-Based Filtering)**
    -   **Trigger:** A user with a low interaction count (e.g., fewer than 5 interactions).
    -   **Method:** A content-based filtering approach that maps a user's stated `mood` to relevant video content using keywords extracted from the post's summary and tags. This ensures new users receive relevant content immediately without requiring any historical data.

-   **Tier 2: The GNN-Powered Engine (Personalized Recommendations)**
    -   **Trigger:** A user with a sufficient interaction history.
    -   **Method:** A pre-trained **LightGCN** (Light Graph Convolutional Network) model generates highly personalized recommendations. The model learns from the complex relationships in the user-item interaction graph (views, likes, inspires, ratings) to predict which content a user is most likely to engage with.

-   **Tier 3: The Category Filter (Post-Processing)**
    -   **Trigger:** The presence of the `project_code` query parameter in an API request.
    -   **Method:** A simple metadata filter applied to the list of recommendations generated by either Tier 1 or Tier 2, allowing for category-specific feeds.

## 2. Tech Stack

-   **Backend Framework:** FastAPI
-   **Database:** PostgreSQL
-   **ORM:** SQLAlchemy
-   **Database Migrations:** Alembic
-   **Deep Learning:** PyTorch
-   **GNN Model:** LightGCN
-   **API Testing:** Postman

## 3. Setup and Installation

Follow these steps to set up and run the project locally.

### 3.1. Prerequisites

-   Python 3.8+
-   PostgreSQL
-   Git

### 3.2. Installation Steps

1.  **Clone the Repository:**
    ```bash
    git clone [https://github.com/Tim-Alpha/video-recommendation-assignment.git](https://github.com/Tim-Alpha/video-recommendation-assignment.git)
    cd video-recommendation-assignment
    ```

2.  **Create and Activate a Virtual Environment:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate  # On Windows: .\venv\Scripts\activate
    ```

3.  **Install Dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Set Up the Database:**
    -   Ensure your PostgreSQL server is running.
    -   Log in to `psql` and create the database and user:
        ```sql
        CREATE DATABASE video_recommendations;
        CREATE USER "user" WITH PASSWORD 'password';
        GRANT ALL PRIVILEGES ON DATABASE video_recommendations TO "user";
        ```

5.  **Configure Environment Variables:**
    -   Create a `.env` file in the project root.
    -   Add your API token and the base URL:
        ```env
        FLIC_TOKEN=flic_11d3da28e403d182c36a3530453e290add87d0b4a40ee50f17611f180d47956f
        API_BASE_URL=[https://api.socialverseapp.com](https://api.socialverseapp.com)
        ```

## 4. Running the Project

The project runs in three distinct stages. Execute these commands from your terminal in the project's root directory.

1.  **Stage 1: Collect Data**
    -   This script fetches all users, posts, and interactions from the SocialVerse API and populates your PostgreSQL database. This will take some time.
    ```bash
    python data_collector.py
    ```

2.  **Stage 2: Train the Recommendation Model**
    -   This script reads the interaction data from your database, builds the user-item graph, and trains the LightGCN model. It will save the trained model weights to a file named `lightgcn_model.pth`.
    ```bash
    python train_gnn.py
    ```

3.  **Stage 3: Run the API Server**
    -   This command starts the FastAPI server, which loads the trained model and exposes the API endpoints.
    ```bash
    uvicorn app.main:app --reload
    ```
    The API will be available at `http://127.0.0.1:8000`.

## 5. API Documentation

The primary endpoint for fetching recommendations is `/feed`.

### `GET /feed`

Returns a personalized feed of videos based on the user's interaction history.

-   **URL:** `http://127.0.0.1:8000/feed`
-   **Method:** `GET`
-   **Query Parameters:**
    -   `username` (string, **required**): The username of the user requesting the feed.
    -   `mood` (string, optional, default: `inspired`): The user's current mood. This is used only for new users who fall under the cold-start condition.
    -   `project_code` (string, optional): Filters the recommendations to a specific category.

#### Example Usage:

-   **For an existing user (GNN Recommendation):**
    `http://127.0.0.1:8000/feed?username=sachin`

-   **For a new user (Mood-Based Recommendation):**
    `http://127.0.0.1:8000/feed?username=new_user_name&mood=happy`

-   **With a category filter:**
    `http://127.0.0.1:8000/feed?username=sachin&project_code=flic`


## üìä API Endpoints

### Recommendation Endpoints Has to Build

1. **Get Personalized Feed**

   ```
   GET /feed?username={username}
   ```

   Returns personalized video recommendations for a specific user.
2. **Get Category-based Feed**

   ```
   GET /feed?username={username}&project_code={project_code}
   ```

   Returns category-specific video recommendations for a user.

### Data Collection Endpoints (Internal Use)

APIs for data collection:

### APIs

1. **Get All Viewed Posts** (METHOD: GET):

   ```
   https://api.socialverseapp.com/posts/view?page=1&page_size=1000&resonance_algorithm=resonance_algorithm_cjsvervb7dbhss8bdrj89s44jfjdbsjd0xnjkbvuire8zcjwerui3njfbvsujc5if
   ```
2. **Get All Liked Posts** (METHOD: GET):

   ```
   https://api.socialverseapp.com/posts/like?page=1&page_size=1000&resonance_algorithm=resonance_algorithm_cjsvervb7dbhss8bdrj89s44jfjdbsjd0xnjkbvuire8zcjwerui3njfbvsujc5if
   ```
3. **Get All Inspired posts** (METHOD: GET):

   ```
   https://api.socialverseapp.com/posts/inspire?page=1&page_size=1000&resonance_algorithm=resonance_algorithm_cjsvervb7dbhss8bdrj89s44jfjdbsjd0xnjkbvuire8zcjwerui3njfbvsujc5if
   ```
4. **Get All Rated posts** (METHOD: GET):

   ```
   https://api.socialverseapp.com/posts/rating?page=1&page_size=1000&resonance_algorithm=resonance_algorithm_cjsvervb7dbhss8bdrj89s44jfjdbsjd0xnjkbvuire8zcjwerui3njfbvsujc5if
   ```
5. **Get All Posts** (Header required*) (METHOD: GET):

   ```
   https://api.socialverseapp.com/posts/summary/get?page=1&page_size=1000
   ```
6. **Get All Users** (Header required*) (METHOD: GET):

   ```
   https://api.socialverseapp.com/users/get_all?page=1&page_size=1000
   ```

### Authorization

For autherization pass `Flic-Token` as header in the API request:

Header:

```json
"Flic-Token": "flic_11d3da28e403d182c36a3530453e290add87d0b4a40ee50f17611f180d47956f"
```

**Note**: All external API calls require the Flic-Token header:


## üìù Submission Requirements

1. **GitHub Repository**
   - Submit a merge request from your fork or cloned repository.
   - Include a complete Postman collection demonstrating your API endpoints.
   - Add a docs folder explaining how your recommendation system works.
2. **Video Submission**
   - Introduction Video (30‚Äì40 seconds)
     - A short personal introduction (with face-cam).
   - Technical Demo (3‚Äì5 minutes)
     - Live demonstration of the APIs using Postman.
     - Brief overview of the project.
       Video Submission

3. **Notification**

   - Join the Telegram group: [Video Recommendation](https://t.me/+VljbLT8o75QxN2I9)
   - Notify upon completion

## ‚úÖ Evaluation Checklist

- [ ] All APIs are functional
- [ ] Database migrations work correctly
- [ ] README is complete and clear
- [ ] Postman collection is included
- [ ] Videos are submitted
- [ ] Code is well-documented
- [ ] Implementation handles edge cases
- [ ] Proper error handling is implemented
